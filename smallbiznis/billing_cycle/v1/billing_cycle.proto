syntax = "proto3";

package smallbiznis.billing_cycle.v1;

option go_package = "github.com/smallbiznis/go-genproto/smallbiznis/billing_cycle/v1;billingcycle";

import "google/protobuf/timestamp.proto";

// SubscriptionBillingSchedule represents a recurring billing evaluation for a
// subscription. Schedulers use this to determine when to trigger rating and
// invoice generation events.
message SubscriptionBillingSchedule {
  // Tenant that owns the subscription.
  string tenant_id = 1;
  // Subscription to evaluate.
  string subscription_id = 2;
  // Human readable period description (e.g., "monthly").
  string period = 3;
  // Timestamp when the next billing run should occur.
  google.protobuf.Timestamp next_run_at = 4;
  // Timestamp when the schedule was last executed.
  google.protobuf.Timestamp last_run_at = 5;
}

// Request to upsert a schedule for a subscription.
message UpsertScheduleRequest {
  SubscriptionBillingSchedule schedule = 1;
}

// Response confirming schedule persistence.
message UpsertScheduleResponse {
  SubscriptionBillingSchedule schedule = 1;
}

// Request to list schedules for a tenant.
message GetScheduleRequest {
  string tenant_id = 1;
  int32 page_size = 2;
  string page_token = 3;
}

// Response containing schedules and pagination token.
message GetScheduleResponse {
  SubscriptionBillingSchedule schedule = 1;
}

// BillingScheduleService manages when subscriptions should be billed.
service BillingScheduleService {
  // Create or update a billing schedule for a subscription.
  rpc UpsertSchedule(UpsertScheduleRequest) returns (UpsertScheduleResponse);

  // List billing schedules for a tenant.
  rpc GetSchedule(GetScheduleRequest) returns (GetScheduleResponse);
}
