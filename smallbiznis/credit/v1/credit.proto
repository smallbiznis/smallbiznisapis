syntax = "proto3";

package smallbiznis.credit.v1;

option go_package = "github.com/smallbiznis/go-genproto/smallbiznis/credit/v1;creditv1";

import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/struct.proto";
import "smallbiznis/common/money.proto";

enum CreditType {
  CREDIT_TYPE_UNSPECIFIED = 0;
  CREDIT_TYPE_ADJUSTMENT  = 1;
  CREDIT_TYPE_REFUND      = 2;
  CREDIT_TYPE_BALANCE     = 3;
}

message CreditNote {
  string id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE
  ];
  string tenant_id = 2 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE
  ];
  string invoice_id = 3 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE
  ];
  CreditType type = 4 [(google.api.field_behavior) = REQUIRED];
  smallbiznis.common.Money amount = 5 [(google.api.field_behavior) = REQUIRED];
  string reason = 6 [(google.api.field_behavior) = REQUIRED];
  google.protobuf.Struct metadata = 7;
  google.protobuf.Timestamp created_at = 10
      [(google.api.field_behavior) = OUTPUT_ONLY];
}

message CreateCreditNoteRequest {
  string invoice_id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE
  ];
  CreditType type = 2 [(google.api.field_behavior) = REQUIRED];
  smallbiznis.common.Money amount = 3 [(google.api.field_behavior) = REQUIRED];
  string reason = 4 [(google.api.field_behavior) = REQUIRED];
}

message CreateCreditNoteResponse {
  CreditNote credit_note = 1 [(google.api.field_behavior) = OUTPUT_ONLY];
}

message ListCreditNotesRequest {
  string tenant_id = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.field_behavior) = IMMUTABLE
  ];
  string invoice_id = 2;
}

message ListCreditNotesResponse {
  repeated CreditNote credit_notes = 1
      [(google.api.field_behavior) = OUTPUT_ONLY];
}

service CreditService {
  rpc CreateCreditNote(CreateCreditNoteRequest) returns (CreateCreditNoteResponse) {
    option (google.api.http) = {
      post: "/v1/credit-notes"
      body: "*"
    };
  }

  rpc ListCreditNotes(ListCreditNotesRequest) returns (ListCreditNotesResponse) {
    option (google.api.http) = {
      get: "/v1/credit-notes"
    };
  }
}
