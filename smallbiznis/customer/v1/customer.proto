syntax = "proto3";

package smallbiznis.customer.v1;

option go_package = "github.com/smallbiznis/go-genproto/smallbiznis/customer/v1;customerv1";

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// Customer belongs to a specific tenant and represents an end-customer that is
// billed through SmallBiznis. Customers never own API keys; all API access is
// performed via the parent tenant.
message Customer {
  // Globally unique customer identifier (Snowflake/ULID as string).
  string id = 1;

  // Tenant that owns this customer and will receive revenue from invoices.
  string tenant_id = 2;

  // External reference supplied by the tenant for idempotency or lookup in
  // their own systems.
  string external_reference = 3;

  // Primary email for billing communication.
  string email = 4;

  // Human readable name of the customer.
  string name = 5;

  // Contact phone number with country code when available.
  string phone = 6;

  // Preferred currency for invoices; falls back to tenant default when empty.
  string currency = 7;

  // Billing address structure; shape is tenant-defined.
  google.protobuf.Struct billing_address = 8;

  // Shipping address structure; shape is tenant-defined.
  google.protobuf.Struct shipping_address = 9;

  // Timestamps for auditability.
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;

  // Arbitrary metadata for segmentation or analytics.
  google.protobuf.Struct metadata = 12;
}

// Request to create a new customer under a tenant.
message CreateCustomerRequest {
  // Customer payload to persist. tenant_id is required.
  Customer customer = 1;
}

// Request to fetch a customer by ID within a tenant.
message GetCustomerRequest {
  // Customer identifier.
  string id = 1;
  // Tenant guard to ensure cross-tenant isolation.
  string tenant_id = 2;
}

// ListCustomersRequest paginates customers for a tenant.
message ListCustomersRequest {
  // Tenant whose customers should be returned.
  string tenant_id = 1;
  // Maximum number of records to return.
  int32 page_size = 2;
  // Token to continue from a previous page.
  string page_token = 3;
}

// ListCustomersResponse returns a page of customers.
message ListCustomersResponse {
  repeated Customer customers = 1;
  string next_page_token = 2;
}

// Request to update mutable customer fields. Server should merge metadata based
// on implementation.
message UpdateCustomerRequest {
  Customer customer = 1;
}

// CustomerService exposes CRUD-style operations for tenant-owned customers.
service CustomerService {
  // Create a new customer.
  rpc CreateCustomer(CreateCustomerRequest) returns (Customer);

  // Retrieve a single customer by id within a tenant context.
  rpc GetCustomer(GetCustomerRequest) returns (Customer);

  // List customers for a tenant with pagination support.
  rpc ListCustomers(ListCustomersRequest) returns (ListCustomersResponse);

  // Update existing customer details.
  rpc UpdateCustomer(UpdateCustomerRequest) returns (Customer);
}
