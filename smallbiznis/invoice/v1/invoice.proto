syntax = "proto3";

package smallbiznis.invoice.v1;

option go_package = "github.com/smallbiznis/go-genproto/smallbiznis/invoice/v1;invoicev1";

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// Invoice is the final bill for a tenant's customer over a billing period.
message Invoice {
  // Unique invoice identifier.
  string id = 1;
  // Tenant issuing the invoice.
  string tenant_id = 2;
  // Customer being billed.
  string customer_id = 3;
  // Subscription that produced the charges.
  string subscription_id = 4;
  // Lifecycle status of the invoice.
  InvoiceStatus status = 5;
  // Currency for all amounts on the invoice.
  string currency_code = 6;
  // Total payable amount in cents.
  int64 total_cents = 7;
  // Subtotal before discounts and taxes in cents.
  int64 subtotal_cents = 8;
  // Total tax amount in cents.
  int64 tax_cents = 9;
  // Unique invoice number per tenant (for reconciliation).
  string invoice_number = 10;
  // Timestamp when the invoice was issued.
  google.protobuf.Timestamp issued_at = 11;
  // Timestamp when the invoice is due.
  google.protobuf.Timestamp due_at = 12;
  // Timestamp when the invoice was fully paid.
  google.protobuf.Timestamp paid_at = 13;
  // Arbitrary metadata for bookkeeping.
  google.protobuf.Struct metadata = 14;
}

// InvoiceStatus enumerates lifecycle states for invoices.
enum InvoiceStatus {
  INVOICE_STATUS_UNSPECIFIED = 0;
  INVOICE_STATUS_DRAFT = 1;
  INVOICE_STATUS_OPEN = 2;
  INVOICE_STATUS_PAID = 3;
  INVOICE_STATUS_VOID = 4;
  INVOICE_STATUS_UNCOLLECTIBLE = 5;
}

// InvoiceLineItem represents a rated charge included on an invoice.
message InvoiceLineItem {
  // Unique line item identifier.
  string id = 1;
  // Associated invoice ID.
  string invoice_id = 2;
  // Meter code used to derive the charge.
  string meter_code = 3;
  // Price that produced the charge.
  string price_id = 4;
  // Human readable description of the charge.
  string description = 5;
  // Quantity billed.
  double quantity = 6;
  // Unit amount in cents before tax/discount.
  int64 unit_amount_cents = 7;
  // Total amount for the line in cents.
  int64 amount_cents = 8;
  // Arbitrary metadata for reconciliation.
  google.protobuf.Struct metadata = 9;
}

// Request to retrieve a single invoice.
message GetInvoiceRequest {
  string id = 1;
  string tenant_id = 2;
}

// Request to list invoices for a tenant/customer.
message ListInvoicesRequest {
  string tenant_id = 1;
  string customer_id = 2;
  string subscription_id = 3;
  InvoiceStatus status = 4;
  int32 page_size = 5;
  string page_token = 6;
}

// Response containing invoices and pagination token.
message ListInvoicesResponse {
  repeated Invoice invoices = 1;
  string next_page_token = 2;
}

// InvoiceService provides read APIs for invoices created by the invoice engine.
service InvoiceService {
  // Retrieve a single invoice by ID within a tenant.
  rpc GetInvoice(GetInvoiceRequest) returns (Invoice) {
    option (google.api.http) = {
        get: "/v1/invoices/{invoice_id}"
    };
  };

  // List invoices for a tenant with optional customer or subscription filters.
  rpc ListInvoices(ListInvoicesRequest) returns (ListInvoicesResponse) {
    option (google.api.http) = {
        get: "/v1/invoices"
    };
  };
}
