// IMPORTANT: LOCKED SPEC. Only change with explicit migration.
syntax = "proto3";

package smallbiznis.price.v1;

option go_package = "github.com/smallbiznis/go-genproto/smallbiznis/price/v1;pricev1";

import "google/api/annotations.proto";
import "google/type/money.proto";

enum PriceUsageType {
  PRICE_USAGE_TYPE_UNSPECIFIED = 0;
  LICENSED = 1;
  METERED  = 2;
}

enum PriceBillingScheme {
  PRICE_BILLING_SCHEME_UNSPECIFIED = 0;
  PER_UNIT = 1;
  TIERED   = 2;
}

enum BillingPeriod {
  BILLING_PERIOD_UNSPECIFIED = 0;
  DAILY   = 1;
  MONTHLY = 2;
  ANNUAL  = 3;
}

message PriceTier {
  int64 up_to = 1;
  google.type.Money unit_amount = 2;
}

message Price {
  string id = 1;
  string product_id = 2;
  google.type.Money unit_amount = 3;
  string currency = 4;
  PriceBillingScheme billing_scheme = 5;
  PriceUsageType usage_type = 6;
  BillingPeriod billing_period = 7;
  string meter_id = 8;
  repeated PriceTier tiers = 9;
}

message CreatePriceRequest {
  Price price = 1;
}

message CreatePriceResponse {
  Price price = 1;
}

message GetPriceRequest {
  string id = 1;
}

message ListPricesRequest {
  string product_id = 1;
  int32 page_size = 2;
  string page_token = 3;
}

message ListPricesResponse {
  repeated Price prices = 1;
  string next_page_token = 2;
}

message UpdatePriceRequest {
  Price price = 1;
}

message UpdatePriceResponse {
  Price price = 1;
}

service PriceService {
  rpc CreatePrice(CreatePriceRequest) returns (CreatePriceResponse) {
    option (google.api.http) = {
      post: "/v2/prices"
      body: "price"
    };
  }

  rpc GetPrice(GetPriceRequest) returns (Price) {
    option (google.api.http) = {
      get: "/v2/prices/{id}"
    };
  }

  rpc ListPrices(ListPricesRequest) returns (ListPricesResponse) {
    option (google.api.http) = {
      get: "/v2/prices"
    };
  }

  rpc UpdatePrice(UpdatePriceRequest) returns (UpdatePriceResponse) {
    option (google.api.http) = {
      patch: "/v2/prices/{price.id}"
      body: "price"
    };
  }
}
